<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data pipeline &mdash; AtomDNN  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Energy calculation" href="energy_calculation.html" />
    <link rel="prev" title="Example" href="../getstarted/example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> AtomDNN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/example.html">Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-create-descriptor">Step 1: Create descriptor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-read-inputs-outputs">Step 2: Read inputs&amp;outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-create-tensorflow-dataset">Step 3: Create tensorflow dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="energy_calculation.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="force_calculation.html">Force and stress calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lammps.html">LAMMPS interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../module/descriptor.html">Descriptor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module/data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module/network.html">Network</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/funding.html">Funding</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AtomDNN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Data pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/data_pipeline.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="data-pipeline">
<h1>Data pipeline<a class="headerlink" href="#data-pipeline" title="Permalink to this heading"></a></h1>
<p>From the initial data of atomic structures to the tensorflow
dataset that can be used for training, a data pipeline goes through
the following three steps, which is demonstated in the example
script. This data pipeline is designed for convenient data
manipulation and data transparency.</p>
<section id="step-1-create-descriptor">
<h2>Step 1: Create descriptor<a class="headerlink" href="#step-1-create-descriptor" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>Users just need to provide the atomic structures saved as extxyz files (with lattice, atom coordinates, potential energy, atomic forces and stress),
which are converted to lammps datafiles (with ASE, lmpdata files are not saved) in order to compute descriptors and derivatives (in the format of lammps dump files). LAMMPS has to be pre-compiled with the subroutines(compute and
dump_local) inside atomdnn/lammps folder. The function to create descriptors is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_descriptors</span><span class="p">(</span><span class="n">xyzfile_path</span> <span class="o">=</span> <span class="n">xyzfile_path</span><span class="p">,</span> \
                   <span class="n">xyzfile_name</span> <span class="o">=</span> <span class="n">xyzfile_name</span><span class="p">,</span> \
                   <span class="n">lmpexe</span> <span class="o">=</span> <span class="n">lmpexe</span><span class="p">,</span> \
                   <span class="n">descriptors_path</span> <span class="o">=</span> <span class="n">descriptors_path</span><span class="p">,</span> \
                   <span class="n">descriptor</span> <span class="o">=</span> <span class="n">descriptor</span><span class="p">,</span> \
                   <span class="n">descriptor_filename</span> <span class="o">=</span> <span class="n">descriptor_filename</span><span class="p">,</span> \
                   <span class="n">der_filename</span> <span class="o">=</span> <span class="n">der_filename</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-2-read-inputs-outputs">
<h2>Step 2: Read inputs&amp;outputs<a class="headerlink" href="#step-2-read-inputs-outputs" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>We use a python class object ‘Data’ to handle reading inputs and
outputs. The inputs are descriptors and their derivatives and
outputs include potential energies, atomic forces and stress.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mdata</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
<span class="n">mdata</span><span class="o">.</span><span class="n">read_inputdata</span><span class="p">(</span><span class="n">fp_filename</span><span class="o">=</span><span class="n">fp_filename</span><span class="p">,</span><span class="n">der_filename</span><span class="o">=</span><span class="n">der_filename</span><span class="p">)</span>
<span class="n">mdata</span><span class="o">.</span><span class="n">read_outputdata</span><span class="p">(</span><span class="n">xyzfile_path</span><span class="o">=</span><span class="n">xyzfile_path</span><span class="p">,</span> <span class="n">xyzfile_name</span><span class="o">=</span><span class="n">xyzfile_name</span><span class="p">)</span>
</pre></div>
</div>
<p>This data object can be conveniently manipulated. For example, the inputs can be accessed as (assuming the Data object is called mdata):</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>mdata.input_dict[‘fingerprints’][i][j][k]</strong> gives the k-th fingerprint of j-th atom in i-th image.</p></li>
<li><p><strong>mdata.input_dict[‘atom_type’][i][j]</strong> gives the atom type of j-th atom in i-th image.</p></li>
<li><p><strong>mdata.input_dict[‘volume’][i]</strong> gives the volume of i-th image</p></li>
<li><p><strong>mdata.input_dict[‘dGdr’][i][j][k][m]</strong> gives the derivative of k-th fingerprint in j-th derivative pair of i-th image w.r.t m-th cooridinate.</p></li>
<li><p><strong>mdata.input_dict[‘center_atom_id’][i][j]</strong> gives the center atom id in j-th derivative pair of i-th image.</p></li>
<li><p><strong>mdata.input_dict [‘neighbor_atom_id’][i][j]</strong> gives the neighbor atom id in j-th derivative pair of i-th image. Note that the neighbors could be ghost atoms.</p></li>
<li><p><strong>mdata.input_dict [‘neighbor_atom_coord’][i][j][m][0]</strong> gives the m-th coordiate of neighbor atom in j-th derivative pair of i-th image. Note that the last dimension of the array is 1 which is added for matrix multiplication in neural network force_stress_layer.</p></li>
</ul>
</div></blockquote>
<p>The outputs can be accessed as:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>mdata.output_dict[‘pe’][i]</strong> gives the potential energy of i-th image.</p></li>
<li><p><strong>mdata.output_dict[‘force’][i][j]</strong> gives the force vector of j-th atom in i-th image.</p></li>
<li><p><strong>mdata.output_dict[‘stress’][i]</strong> gives the stress of i-th image</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="step-3-create-tensorflow-dataset">
<h2>Step 3: Create tensorflow dataset<a class="headerlink" href="#step-3-create-tensorflow-dataset" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>For the convenience of reuse and share the data, data are saved in the format of tensorflow dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tf_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">mdata</span><span class="o">.</span><span class="n">input_dict</span><span class="p">,</span><span class="n">mdata</span><span class="o">.</span><span class="n">output_dict</span><span class="p">))</span>
<span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tf_dataset</span><span class="p">,</span> <span class="n">dataset_path</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../getstarted/example.html" class="btn btn-neutral float-left" title="Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="energy_calculation.html" class="btn btn-neutral float-right" title="Energy calculation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Gao-group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>