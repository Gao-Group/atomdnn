<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Load tensorflow dataset &mdash; AtomDNN  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Atom descritpor" href="atom_descriptor.html" />
    <link rel="prev" title="Welcome to AtomDNN’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> AtomDNN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Load tensorflow dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Build-Network-object-from-class-Network">Build Network object from class Network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#__init__(self,-elements=None,-num_fingerprints=None,-arch=None,activation_function=None,-data_type=None,-import_dir=None)">__init__(self, elements=None, num_fingerprints=None, arch=None,activation_function=None, data_type=None, import_dir=None)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Train-the-model">Train the model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#train(self,-train_dataset,-val_dataset,-batch_size=None,-epochs=None,-loss_fn=None,-optimizer=None,-lr=None,-loss_weights=None,-shuffle=True)">train(self, train_dataset, val_dataset, batch_size=None, epochs=None, loss_fn=None, optimizer=None, lr=None, loss_weights=None, shuffle=True)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-training-and-validation-loss-history-is-stored-in-the-dictionary,-with-the-keys-of-‘pe_loss’,-‘force_loss’,-‘stress_loss’-and-‘total_loss’:">The training and validation loss history is stored in the dictionary, with the keys of ‘pe_loss’, ‘force_loss’, ‘stress_loss’ and ‘total_loss’:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Evaluate-dataset">Evaluate dataset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluate(self,dataset,-batch_size=None,-compute_force=atomdnn.compute_force):">evaluate(self,dataset, batch_size=None, compute_force=atomdnn.compute_force):</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Prediction">Prediction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#predict(self,-input_dict,-compute_force=atomdnn.compute_force,-training=False)">predict(self, input_dict, compute_force=atomdnn.compute_force, training=False)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Save-trained-model">Save trained model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#save(obj,-model_dir,-descriptor=None)">save(obj, model_dir, descriptor=None)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-the-saved-model-for-continuous-training-and-prediction">Load the saved model for continuous training and prediction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="atom_descriptor.html">Atom descritpor</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_pipeline.html">Data pipline</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Potential training</a></li>
<li class="toctree-l1"><a class="reference internal" href="prediction.html">Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="energy_calculation.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="force_calculation.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="stress_calculation.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lammps.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Energy calculation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AtomDNN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Load tensorflow dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">atomdnn</span>

<span class="c1"># &#39;float32&#39; is used for reading data and train by default, one can set data_type to &#39;float64&#39; here</span>
<span class="n">atomdnn</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span>

<span class="c1"># force and stress are evaluated by default,</span>
<span class="c1"># if one only need to compute potential energy, then set compute_force to false</span>
<span class="n">atomdnn</span><span class="o">.</span><span class="n">compute_force</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># default value is for converting ev/A^3 to GPa</span>
<span class="c1"># note that: the predicted positive stress means tension and negative stress means compression</span>
<span class="n">stress_unit_convert</span> <span class="o">=</span> <span class="mf">160.2176</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">atomdnn</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">atomdnn</span> <span class="kn">import</span> <span class="n">network</span>
<span class="kn">from</span> <span class="nn">atomdnn.data</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">atomdnn.data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">atomdnn.network</span> <span class="kn">import</span> <span class="n">Network</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Num GPUs Available: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Num GPUs Available:  4
</pre></div></div>
</div>
<section id="Load-tensorflow-dataset">
<h1>Load tensorflow dataset<a class="headerlink" href="#Load-tensorflow-dataset" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/workspace/data/group_share/graphene_tfdataset&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-10-06 16:38:13.808938: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 9673 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:19:00.0, compute capability: 7.5
2021-10-06 16:38:13.809950: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:1 with 9673 MB memory:  -&gt; device: 1, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:1a:00.0, compute capability: 7.5
2021-10-06 16:38:13.810772: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:2 with 9673 MB memory:  -&gt; device: 2, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:67:00.0, compute capability: 7.5
2021-10-06 16:38:13.811548: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:3 with 9673 MB memory:  -&gt; device: 3, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:68:00.0, compute capability: 7.5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">split_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traning data: 630 images
Validation data: 180 images
Test data: 90 images
</pre></div></div>
</div>
</section>
<section id="Build-Network-object-from-class-Network">
<h1>Build Network object from class Network<a class="headerlink" href="#Build-Network-object-from-class-Network" title="Permalink to this headline"></a></h1>
<section id="__init__(self,-elements=None,-num_fingerprints=None,-arch=None,activation_function=None,-data_type=None,-import_dir=None)">
<h2>__init__(self, elements=None, num_fingerprints=None, arch=None,activation_function=None, data_type=None, import_dir=None)<a class="headerlink" href="#__init__(self,-elements=None,-num_fingerprints=None,-arch=None,activation_function=None,-data_type=None,-import_dir=None)" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>elements:</strong> element list, required</p></li>
<li><p><strong>num_fingerprints:</strong> number of fingerprints in data, required</p></li>
<li><p><strong>arch:</strong> number of layers of neural network</p></li>
<li><p><strong>activation_function:</strong> if not set, default is ‘tanh’</p></li>
<li><p><strong>import_dir:</strong> read from the directory of a saved (imported) network, if used, all other parameters are disabled</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
<span class="n">act_fun</span> <span class="o">=</span> <span class="s1">&#39;tanh&#39;</span> <span class="c1"># activation function</span>
<span class="n">nfp</span> <span class="o">=</span> <span class="n">get_fingerprints_num</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="c1"># number of fingerprints</span>
<span class="n">arch</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span> <span class="c1"># NN layers</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span><span class="n">num_fingerprints</span><span class="o">=</span><span class="n">nfp</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span><span class="n">activation_function</span><span class="o">=</span><span class="n">act_fun</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Train-the-model">
<h1>Train the model<a class="headerlink" href="#Train-the-model" title="Permalink to this headline"></a></h1>
<section id="train(self,-train_dataset,-val_dataset,-batch_size=None,-epochs=None,-loss_fn=None,-optimizer=None,-lr=None,-loss_weights=None,-shuffle=True)">
<h2>train(self, train_dataset, val_dataset, batch_size=None, epochs=None, loss_fn=None, optimizer=None, lr=None, loss_weights=None, shuffle=True)<a class="headerlink" href="#train(self,-train_dataset,-val_dataset,-batch_size=None,-epochs=None,-loss_fn=None,-optimizer=None,-lr=None,-loss_weights=None,-shuffle=True)" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>train_dataset</strong>: tensorflow dataset for training</p></li>
<li><p><strong>val_dataset</strong>: tensorflow dataset for validation</p></li>
<li><p><strong>batch_size</strong>: if not set, use 30</p></li>
<li><p><strong>scaling</strong>: ‘std’ or ‘norm’</p></li>
<li><p><strong>epochs</strong>: if not set, use 1</p></li>
<li><p><strong>opimizer</strong>: if not set, use Adam</p></li>
<li><p><strong>lr</strong>: learning rate, if not set, use 0.01</p></li>
<li><p><strong>loss_weights</strong>: sets the weights for loss function, if not set, use {‘pe’:1,‘force’:0,‘stress’:0}</p></li>
<li><p><strong>compute_all_loss</strong>: set to True, if want to compute force or stress loss even when it is trained</p></li>
<li><p><strong>shuffle</strong>: training dataset is shuffled during training</p></li>
</ul>
</section>
<section id="The-training-and-validation-loss-history-is-stored-in-the-dictionary,-with-the-keys-of-‘pe_loss’,-‘force_loss’,-‘stress_loss’-and-‘total_loss’:">
<h2>The training and validation loss history is stored in the dictionary, with the keys of ‘pe_loss’, ‘force_loss’, ‘stress_loss’ and ‘total_loss’:<a class="headerlink" href="#The-training-and-validation-loss-history-is-stored-in-the-dictionary,-with-the-keys-of-‘pe_loss’,-‘force_loss’,-‘stress_loss’-and-‘total_loss’:" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>train_loss</strong></p></li>
<li><p><strong>val_loss</strong></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">loss_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pe&#39;</span> <span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;force&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>

<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">loss_weights</span><span class="o">=</span><span class="n">loss_weights</span><span class="p">,</span> <span class="n">compute_all_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Forces are used for training.
Stresses are used for training.
Scaling factors are computed using training dataset.
Training dataset are standardized.
Validation dataset are standardized.
Training dataset will be shuffled during training.

===&gt; Epoch 1/5 - 3.784s/epoch
     training_loss    - pe_loss: 7.094 - force_loss: 3.104 - stress_loss: 4.037 - total_loss: 3.579
     validation_loss  - pe_loss: 4.771 - force_loss: 2.086 - stress_loss: 3.931 - total_loss: 2.527

===&gt; Epoch 2/5 - 4.300s/epoch
     training_loss    - pe_loss: 5.643 - force_loss: 2.172 - stress_loss: 3.850 - total_loss: 2.613
     validation_loss  - pe_loss: 3.471 - force_loss: 1.779 - stress_loss: 3.553 - total_loss: 2.169

===&gt; Epoch 3/5 - 4.414s/epoch
     training_loss    - pe_loss: 3.577 - force_loss: 1.887 - stress_loss: 3.468 - total_loss: 2.270
     validation_loss  - pe_loss: 3.089 - force_loss: 1.583 - stress_loss: 3.497 - total_loss: 1.963

===&gt; Epoch 4/5 - 4.294s/epoch
     training_loss    - pe_loss: 4.003 - force_loss: 1.694 - stress_loss: 3.423 - total_loss: 2.077
     validation_loss  - pe_loss: 3.126 - force_loss: 1.561 - stress_loss: 3.491 - total_loss: 1.941

===&gt; Epoch 5/5 - 4.311s/epoch
     training_loss    - pe_loss: 3.410 - force_loss: 1.608 - stress_loss: 3.411 - total_loss: 1.983
     validation_loss  - pe_loss: 5.088 - force_loss: 1.533 - stress_loss: 3.531 - total_loss: 1.937

End of training, elapsed time:  00:00:21
</pre></div></div>
</div>
<section id="Evaluate-dataset">
<h3>Evaluate dataset<a class="headerlink" href="#Evaluate-dataset" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="evaluate(self,dataset,-batch_size=None,-compute_force=atomdnn.compute_force):">
<h2>evaluate(self,dataset, batch_size=None, compute_force=atomdnn.compute_force):<a class="headerlink" href="#evaluate(self,dataset,-batch_size=None,-compute_force=atomdnn.compute_force):" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>dataset</strong>: tensorflow dataset to be evaluated</p></li>
<li><p><strong>batch_size</strong>: if not set, batch_size equals to the total size of dataset</p></li>
<li><p><strong>compute</strong>: if compute force, derivative data are needed</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Evaluation loss is:
        pe_loss:       8.6793e+00
     force_loss:       3.4607e+00
    stress_loss:       3.7702e+00
     total_loss:       3.8570e+00

The prediction is:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;pe&#39;: array([-136.5099332 , -153.36502206, -149.57517951, -137.59869475,
        -124.8382558 , -118.13533883, -153.14154835, -134.70615341,
        -149.96450679, -127.16005955, -155.38543964, -117.6680732 ,
        -154.04367329, -170.97124755, -118.43644831, -169.89147124,
        -117.78726752, -116.03680741, -146.17187856, -124.9586848 ,
        -128.23741664, -155.36981963, -152.28306911, -155.38237189,
        -152.63277298, -117.28881916, -153.41835937, -153.62306094,
        -129.51416793, -145.05603439, -150.17358081, -145.91307868,
        -149.62308402, -152.83943987, -154.57141097, -146.24003045,
        -145.76021344, -128.50909839, -144.99060896, -151.05341888,
        -153.79768343, -117.44627967, -145.52135071, -154.19088723,
        -136.7003158 , -121.71373037, -151.10673311, -153.82906805,
        -145.22175573, -146.626616  , -159.0531481 , -117.27946118,
        -148.90201732, -153.28939254, -148.0694924 , -117.04860229,
        -119.58228008, -115.17236224, -153.81193783, -153.4762273 ,
        -158.837383  , -170.08640368, -153.31482468, -148.96872059,
        -154.62498204, -144.95754163, -148.45018351, -147.11440005,
        -153.11980294, -169.42833843, -144.66695432, -148.64139285,
        -153.59972386, -123.44803218, -131.24813867, -141.3013643 ,
        -154.60489959, -130.70632477, -132.54729533, -125.82442314,
        -153.42771999, -154.09427745, -151.5000964 , -135.03357216,
        -115.28258691, -128.76492151, -154.6617944 , -153.83244624,
        -135.64111876, -151.20844764]),
 &#39;force&#39;: array([[[ 5.04922715e+00,  3.88846289e+00, -5.76527446e-01],
         [ 1.22667134e+00,  1.19997275e+00,  9.22135692e-01],
         [-1.58717859e+00,  8.76783145e+00, -5.60433405e-01],
         ...,
         [ 4.07822936e-01,  4.14177701e+00, -1.37279283e+00],
         [-4.23734545e+00,  5.86204684e+00,  1.53730706e+00],
         [ 4.79892837e+00, -3.03507866e-01, -2.25026401e-01]],

        [[-4.76447441e-01,  1.63510274e-01,  1.18536005e-01],
         [ 1.05951650e+00,  1.13975326e+00,  3.03026808e-01],
         [-1.10388392e+00,  1.82692624e+00,  2.43670851e-01],
         ...,
         [ 7.98264454e-01,  2.62026199e+00, -1.68686493e-01],
         [ 1.06598347e+00, -6.42911965e-01,  1.83220157e-01],
         [ 2.50873054e-01,  3.51897321e-01, -2.28776273e-01]],

        [[ 9.24702573e-01, -1.08931190e-03, -0.00000000e+00],
         [-9.24905306e-01,  5.92218583e-04, -0.00000000e+00],
         [ 9.26566513e-01, -9.96988931e-04, -0.00000000e+00],
         ...,
         [-9.25626936e-01,  2.27975938e-04, -0.00000000e+00],
         [ 9.21888773e-01, -3.19808144e-04, -0.00000000e+00],
         [-9.24220663e-01, -4.40743145e-03, -0.00000000e+00]],

        ...,

        [[ 2.64616968e-02, -3.71706693e-04, -0.00000000e+00],
         [-2.64029158e-02,  1.38893039e-04, -0.00000000e+00],
         [ 2.61359874e-02,  2.47778867e-04, -0.00000000e+00],
         ...,
         [-2.65509906e-02, -2.02685105e-05, -0.00000000e+00],
         [ 2.64618178e-02,  1.07158671e-04, -0.00000000e+00],
         [-2.64782685e-02, -1.35843035e-04, -0.00000000e+00]],

        [[-3.59044607e+00,  1.10835608e+01, -9.46604757e-01],
         [ 2.26029921e+00, -5.46545232e+00, -1.67526533e+00],
         [ 4.13985908e+00,  1.39411152e+00,  4.02964769e-01],
         ...,
         [ 1.66530980e+00, -2.60827287e-02,  8.01887138e-01],
         [-1.21154715e+00, -4.85026827e+00,  5.94077013e-02],
         [ 3.33416468e-01, -4.00782298e-01, -2.60080878e-01]],

        [[-4.08602142e-02,  7.68139120e-05, -0.00000000e+00],
         [ 4.11223806e-02, -8.99796332e-06, -0.00000000e+00],
         [-4.11389342e-02,  1.47464630e-05, -0.00000000e+00],
         ...,
         [ 4.15420500e-02,  2.29692239e-04, -0.00000000e+00],
         [-4.06144285e-02, -1.72796096e-05, -0.00000000e+00],
         [ 4.10652397e-02, -4.67164872e-04, -0.00000000e+00]]]),
 &#39;stress&#39;: array([[ 3.57077340e+00,  8.19856820e-02, -1.37050677e-01,
          8.19856741e-02,  2.40799502e+00,  1.70158436e-01,
         -1.37050693e-01,  1.70158436e-01,  9.32479722e-02],
        [ 4.45639165e-01,  1.19375497e-01,  7.90199220e-02,
          1.19375496e-01,  5.85550316e-01,  8.91055059e-03,
          7.90199190e-02,  8.91055428e-03,  5.94128996e-03],
        [ 1.53072678e+01,  1.11618942e-07,  0.00000000e+00,
          2.19940210e-07,  1.01732798e+01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 5.11021229e+00,  1.14952698e-01,  2.71693608e-01,
          1.14952700e-01,  3.19133916e+00, -4.36003336e-01,
          2.71693618e-01, -4.36003334e-01,  1.35359063e-01],
        [ 9.96483273e-01, -3.49747015e-01, -3.77041970e-02,
         -3.49747022e-01,  8.53954719e-01, -9.97267953e-02,
         -3.77041996e-02, -9.97267591e-02,  1.16259114e-01],
        [ 2.26257682e+00, -3.29153443e-01, -1.56077854e-02,
         -3.29153446e-01,  1.64220814e+00, -1.18606441e-02,
         -1.56077880e-02, -1.18606418e-02,  9.81112318e-02],
        [-8.75848796e-01,  9.57466910e-02, -6.97029604e-02,
          9.57466938e-02, -1.09655549e+00, -2.07969846e-02,
         -6.97029550e-02, -2.07969864e-02, -8.95910435e-03],
        [ 3.88970006e+00,  4.38156041e-01,  1.17720862e-01,
          4.38156052e-01,  2.70691329e+00,  1.46876931e-01,
          1.17720866e-01,  1.46876915e-01,  1.73141536e-01],
        [ 4.79851807e+00, -1.26029831e-02, -1.60096881e-01,
         -1.26029866e-02,  2.10132888e+00, -1.42966076e-01,
         -1.60096896e-01, -1.42966078e-01,  9.54731552e-02],
        [ 1.44448560e+00,  4.15278909e-01,  1.73671951e-01,
          4.15278910e-01,  9.83542376e-01,  4.27250783e-02,
          1.73671937e-01,  4.27250590e-02,  1.93355263e-01],
        [-8.90704729e-01, -7.91995894e-06,  0.00000000e+00,
         -7.52521451e-06,  4.25121109e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 2.39846107e+00,  4.48981519e-01, -1.11868710e-01,
          4.48981519e-01,  2.09199809e+00, -1.06212783e-01,
         -1.11868712e-01, -1.06212784e-01,  1.52590743e-01],
        [-2.02502617e-01, -1.01685413e-05,  0.00000000e+00,
         -1.03386006e-05,  1.59265665e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [-1.09813848e+00,  1.52640205e-06,  0.00000000e+00,
          1.46636161e-06, -1.26698689e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 1.59277103e+00,  5.69522382e-01,  6.09138753e-02,
          5.69522377e-01,  2.25434210e+00,  1.60104606e-01,
          6.09138764e-02,  1.60104617e-01,  1.54754135e-01],
        [ 7.08739957e+01, -1.35299102e-04,  0.00000000e+00,
         -1.35439882e-04,  7.46221405e+01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 1.72941456e+00, -2.50348989e-01,  8.39584223e-02,
         -2.50348983e-01,  2.22261655e+00,  5.82208388e-02,
          8.39584143e-02,  5.82208249e-02,  1.07319002e-01],
        [ 1.39238643e+00,  4.56627435e-01, -8.29506740e-02,
          4.56627429e-01,  1.43647286e+00, -5.04645936e-03,
         -8.29506791e-02, -5.04645615e-03,  6.25852439e-02],
        [ 3.75334972e+00,  1.09772816e+00,  2.28030389e-01,
          1.09772814e+00,  5.18962165e+00, -5.07469656e-01,
          2.28030338e-01, -5.07469640e-01,  2.58877305e-01],
        [ 1.47129785e+00,  1.93922565e-01, -1.49128122e-01,
          1.93922556e-01, -1.87542398e-01,  1.91508457e-01,
         -1.49128125e-01,  1.91508470e-01,  8.89622589e-02],
        [ 1.77329493e+00, -1.32710093e+00, -3.33061162e-02,
         -1.32710093e+00,  2.26268018e+00,  5.80762374e-02,
         -3.33061051e-02,  5.80762352e-02,  2.14345251e-01],
        [ 3.17322885e-01,  4.81346619e-06,  0.00000000e+00,
          5.01061804e-06,  9.52324747e-01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [-4.62191485e-01, -2.17013016e-01,  1.86225475e-02,
         -2.17013017e-01, -8.60383776e-01,  1.17415403e-02,
          1.86225476e-02,  1.17415433e-02,  6.60413187e-03],
        [-1.13494602e+00, -5.54412926e-05,  0.00000000e+00,
         -5.39899950e-05, -1.35080732e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [-5.35888413e-01, -4.54506597e-02, -1.32782698e-02,
         -4.54506594e-02, -7.09306340e-01,  7.08652888e-03,
         -1.32782670e-02,  7.08652993e-03,  1.90761077e-03],
        [ 2.49847947e+00, -1.35908987e-01, -1.65381022e-03,
         -1.35908988e-01,  2.22945360e+00,  2.02696713e-02,
         -1.65381244e-03,  2.02696724e-02,  9.92687649e-02],
        [ 6.85624365e-01, -1.71158544e-02,  6.61650793e-03,
         -1.71158532e-02,  8.46659663e-01, -5.94377603e-02,
          6.61651270e-03, -5.94377610e-02, -1.35646604e-02],
        [ 3.89166713e-01,  2.66116453e-01, -4.18928128e-02,
          2.66116450e-01,  6.66336227e-01,  8.30731560e-03,
         -4.18928200e-02,  8.30731875e-03, -5.44972294e-03],
        [ 1.94452635e+00, -6.54196751e-01,  2.30505676e-01,
         -6.54196754e-01,  3.27566737e+00, -3.35461647e-01,
          2.30505652e-01, -3.35461615e-01,  2.45779019e-01],
        [ 6.80095071e+00,  9.60381891e-01,  1.10254628e-01,
          9.60381892e-01,  3.20394448e+00, -3.59004663e-01,
          1.10254647e-01, -3.59004630e-01,  8.08240474e-02],
        [ 1.04774238e+00,  4.87233591e-02,  4.27414130e-02,
          4.87233619e-02,  1.31679021e+00, -2.18195942e-02,
          4.27414132e-02, -2.18195991e-02,  1.69749123e-02],
        [ 4.01730398e+00, -6.54542716e-06,  0.00000000e+00,
         -6.43332656e-06,  2.25796408e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 7.26857026e+00, -1.43467693e-05,  0.00000000e+00,
         -1.44093214e-05,  4.64021743e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [-6.55878612e-01,  2.12399961e-02,  1.09197954e-02,
          2.12399956e-02, -9.65347339e-01,  1.85174605e-02,
          1.09197948e-02,  1.85174637e-02, -4.88637347e-03],
        [ 6.37310352e-01,  5.30626609e-07,  0.00000000e+00,
          4.06656846e-07, -1.05996435e-01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 6.83953542e+00, -2.92012927e-01, -1.43558498e-01,
         -2.92012937e-01,  4.27308818e+00,  9.14507511e-03,
         -1.43558517e-01,  9.14506858e-03,  1.11247198e-01],
        [ 6.72048820e+00,  1.51154461e-06,  0.00000000e+00,
          1.51085445e-06,  2.63103887e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 3.68369635e+00,  7.74560034e-01, -5.56509026e-02,
          7.74560043e-01,  2.54144873e+00,  1.65184062e-01,
         -5.56509208e-02,  1.65184031e-01,  1.48260094e-01],
        [ 3.18805377e+00, -4.30696560e-05,  0.00000000e+00,
         -4.32106797e-05,  2.81294181e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 4.04788681e+00,  5.78517181e-01, -4.08570711e-02,
          5.78517190e-01,  4.02229571e+00,  7.71410825e-02,
         -4.08570508e-02,  7.71410800e-02,  1.46345605e-01],
        [-1.11901022e+00, -1.13084271e-01, -4.84268687e-02,
         -1.13084271e-01, -1.14435127e+00, -2.71963363e-02,
         -4.84268664e-02, -2.71963321e-02, -1.27945066e-02],
        [ 2.96829179e+00, -2.88031522e-01,  1.21236356e-01,
         -2.88031517e-01,  1.57071723e+00, -1.45599825e-01,
          1.21236356e-01, -1.45599837e-01,  7.38736753e-02],
        [ 5.13035097e+00,  1.18263779e+00,  2.71297709e-01,
          1.18263779e+00,  5.67779175e+00,  5.32922691e-01,
          2.71297699e-01,  5.32922629e-01,  2.03419354e-01],
        [ 5.21322316e-01, -3.48005184e-01, -1.10667316e-02,
         -3.48005183e-01,  2.94277598e-01, -1.36858416e-02,
         -1.10667333e-02, -1.36858445e-02, -1.39353415e-03],
        [ 3.94685090e+00, -1.28421207e+00,  2.58292179e-01,
         -1.28421208e+00,  4.70478157e+00, -3.88075706e-01,
          2.58292148e-01, -3.88075713e-01,  1.96785566e-01],
        [ 7.31401589e-01,  2.98514144e-01, -1.99747985e-01,
          2.98514138e-01,  1.10415625e+00, -9.35599922e-02,
         -1.99747988e-01, -9.35599908e-02,  9.86322360e-02],
        [ 3.59676955e+00,  1.67078709e-07,  0.00000000e+00,
          1.22770019e-07, -4.28997148e-01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 1.05784950e+00, -1.12680112e-01, -6.59910900e-02,
         -1.12680114e-01,  1.37321435e+00,  4.95216819e-02,
         -6.59910899e-02,  4.95216819e-02,  4.85039208e-02],
        [ 4.28994931e+00,  5.32722851e-01, -1.15722744e-01,
          5.32722835e-01,  6.75950394e+00, -9.49432450e-03,
         -1.15722782e-01, -9.49430137e-03,  1.71806651e-01],
        [ 6.03232056e+00,  1.44275019e+00, -7.00602919e-02,
          1.44275019e+00,  5.59382530e+00,  2.35751341e-01,
         -7.00602802e-02,  2.35751357e-01,  1.94680623e-01],
        [-1.22858723e+00, -2.01621782e-05,  0.00000000e+00,
         -1.94851412e-05, -2.72478634e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 2.36664598e+00,  6.61080563e-01,  1.85674243e-02,
          6.61080560e-01,  2.23016049e+00,  7.06457201e-02,
          1.85674228e-02,  7.06457235e-02,  1.26578850e-01],
        [ 4.73089269e+00,  1.15956250e+00,  2.46123047e-01,
          1.15956251e+00,  4.21777567e+00,  8.19720405e-02,
          2.46123038e-01,  8.19719899e-02,  1.20178793e-01],
        [ 5.20746758e-01, -2.03734508e-01, -2.64067511e-02,
         -2.03734507e-01, -4.26463038e-01, -3.13952317e-02,
         -2.64067500e-02, -3.13952340e-02, -2.18746322e-03],
        [ 3.02240824e+00, -8.70587446e-01, -4.07761370e-01,
         -8.70587437e-01,  2.72198148e+00,  2.67048953e-01,
         -4.07761348e-01,  2.67048927e-01,  1.14520483e-01],
        [ 2.48682342e+00,  5.70814417e-01,  1.37011170e-02,
          5.70814417e-01,  1.95633861e+00,  5.49111423e-02,
          1.37011128e-02,  5.49111383e-02,  1.56984505e-01],
        [ 2.41409481e+00, -3.63961444e-01, -1.97758570e-02,
         -3.63961444e-01,  3.28940843e+00,  5.64898130e-02,
         -1.97758602e-02,  5.64898118e-02,  1.29379870e-01],
        [ 1.04163153e+00,  3.63104582e-01,  2.05095090e-02,
          3.63104579e-01,  2.02713185e+00, -4.38080078e-02,
          2.05095035e-02, -4.38080008e-02,  1.23707622e-01],
        [ 7.88645673e-01, -3.24539973e-01,  3.11972581e-02,
         -3.24539974e-01,  4.24171116e-01,  1.43967228e-01,
          3.11972566e-02,  1.43967221e-01,  1.61154518e-02],
        [-1.12101321e+00,  6.93299525e-02,  2.37958965e-02,
          6.93299525e-02, -1.29890743e+00,  7.75035640e-03,
          2.37958993e-02,  7.75036146e-03, -1.95958352e-02],
        [ 5.99506095e+01, -9.38339173e-06,  0.00000000e+00,
         -9.30117917e-06,  6.18527187e+01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 3.01253598e-01, -2.29121800e-06,  0.00000000e+00,
         -2.25672979e-06, -1.67249272e-01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [-1.01240158e+00,  1.10720338e-01,  5.39477834e-02,
          1.10720338e-01, -1.26412411e+00, -2.74936750e-02,
          5.39477838e-02, -2.74936733e-02, -1.63972490e-02],
        [ 5.64371423e+00,  4.20823644e-02, -2.21150610e-01,
          4.20823606e-02,  4.10328919e+00,  9.75798409e-02,
         -2.21150618e-01,  9.75798376e-02,  1.78438994e-01],
        [-7.14265906e-02,  6.07088306e-02,  4.17105627e-02,
          6.07088295e-02,  5.55889754e-01,  1.72348678e-02,
          4.17105598e-02,  1.72348673e-02,  1.10717650e-02],
        [ 4.73109464e+00,  4.58307975e-05,  0.00000000e+00,
          4.58466448e-05,  2.41152935e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 3.57879591e+00,  4.35631342e-01,  1.32042321e-01,
          4.35631322e-01,  4.43328806e+00,  1.91231460e-01,
          1.32042262e-01,  1.91231492e-01,  1.30954835e-01],
        [ 5.31927102e+00, -3.68547209e-06,  0.00000000e+00,
         -3.65223401e-06,  3.95779549e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 5.31431715e-01,  1.88484058e-01, -7.02650965e-02,
          1.88484058e-01,  9.94139090e-02,  9.10077515e-02,
         -7.02650949e-02,  9.10077529e-02, -1.26818415e-02],
        [ 1.78206185e+01,  4.48837634e-06,  0.00000000e+00,
          4.49820354e-06,  1.64896612e+01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 3.59277074e+00,  6.64727516e-06,  0.00000000e+00,
          6.26983654e-06,  2.23152066e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 2.31512903e+00, -7.40773634e-01, -3.15491528e-01,
         -7.40773620e-01,  4.05873018e+00,  7.13065041e-02,
         -3.15491533e-01,  7.13064861e-02,  1.29530516e-01],
        [ 7.43549257e-01,  6.69014636e-02,  3.73145087e-03,
          6.69014634e-02,  1.93888854e-01,  5.75990587e-02,
          3.73145246e-03,  5.75990614e-02,  2.23515145e-02],
        [ 6.48630741e-01,  1.25522741e+00, -5.48385465e-02,
          1.25522742e+00,  1.08007625e+00, -2.56320916e-02,
         -5.48385367e-02, -2.56320969e-02,  6.56059310e-02],
        [ 2.51812581e+00,  3.64890142e-02,  1.42437323e-01,
          3.64889994e-02,  3.48655413e+00,  2.78639746e-01,
          1.42437294e-01,  2.78639794e-01,  1.61183190e-01],
        [ 3.72761317e+00, -6.74988312e-06,  0.00000000e+00,
         -6.78188969e-06,  1.13099071e+00,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 7.18844594e-01,  1.37191012e-01, -4.46331367e-02,
          1.37191012e-01,  8.40032892e-01,  1.46961509e-02,
         -4.46331353e-02,  1.46961503e-02,  5.71190179e-02],
        [ 2.59178892e+00,  7.44695170e-01,  9.29407372e-02,
          7.44695170e-01,  4.26816319e+00,  1.71333303e-01,
          9.29407251e-02,  1.71333305e-01,  1.58569220e-01],
        [ 3.64260273e+00, -9.37700504e-01,  2.70260448e-02,
         -9.37700498e-01,  4.01270789e+00, -2.63083791e-03,
          2.70260598e-02, -2.63085324e-03,  1.80764460e-01],
        [ 2.43013632e+00,  1.11884963e+00,  8.26960896e-02,
          1.11884963e+00,  6.42678501e-01,  4.53401389e-01,
          8.26960701e-02,  4.53401371e-01,  1.99697420e-01],
        [-1.21038554e+00, -1.65392447e-01,  1.62682438e-01,
         -1.65392447e-01, -7.89165356e-01,  2.39179749e-02,
          1.62682439e-01,  2.39179759e-02, -1.55257192e-02],
        [-1.21819760e+00,  7.36078801e-02, -9.87384462e-02,
          7.36078802e-02, -1.15724308e+00,  3.64972893e-02,
         -9.87384471e-02,  3.64972871e-02, -1.81553222e-02],
        [ 1.04281531e+00,  3.59512931e-01, -1.15593756e-02,
          3.59512933e-01,  6.24048605e-01, -6.62122478e-02,
         -1.15593890e-02, -6.62122511e-02,  3.01460409e-02],
        [ 4.70899275e+00, -3.23532253e-01,  6.20124148e-02,
         -3.23532248e-01,  2.72847329e+00, -3.30867663e-01,
          6.20124252e-02, -3.30867662e-01,  1.27872966e-01],
        [ 3.28639201e+00,  8.19984717e-02, -2.27828084e-01,
          8.19984664e-02,  1.25428293e+00,  2.60722665e-01,
         -2.27828092e-01,  2.60722671e-01,  8.52134009e-02],
        [ 2.35621692e+00,  8.40781522e-01,  3.21368040e-01,
          8.40781522e-01,  3.57495293e-02, -2.41453442e-01,
          3.21368057e-01, -2.41453437e-01,  1.18098033e-01],
        [ 1.25646214e+00,  2.46077151e-05,  0.00000000e+00,
          2.39447113e-05,  1.69920552e-01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 1.24208870e+00, -2.04578602e-05,  0.00000000e+00,
         -2.02682225e-05, -9.66891227e-02,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00],
        [ 4.53816974e+00, -7.74551292e-01, -7.92297885e-02,
         -7.74551285e-01,  5.53934830e+00,  2.49719053e-02,
         -7.92297779e-02,  2.49719018e-02,  2.04015181e-01],
        [ 1.08557667e+01, -6.87589979e-07,  0.00000000e+00,
         -2.30791757e-07,  1.34795074e+01,  0.00000000e+00,
          0.00000000e+00,  0.00000000e+00,  0.00000000e+00]])}
</pre></div></div>
</div>
<section id="Prediction">
<h3>Prediction<a class="headerlink" href="#Prediction" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="predict(self,-input_dict,-compute_force=atomdnn.compute_force,-training=False)">
<h2>predict(self, input_dict, compute_force=atomdnn.compute_force, training=False)<a class="headerlink" href="#predict(self,-input_dict,-compute_force=atomdnn.compute_force,-training=False)" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>input_dict</strong>: input dictionary data, which could be data outside the dataset</p></li>
<li><p><strong>training</strong>: set to False</p></li>
<li><p><strong>compute_force</strong>: if compute force, derivative data are needed</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># take two images from test dataset</span>
<span class="n">input_dict</span> <span class="o">=</span> <span class="n">get_input_dict</span><span class="p">(</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;pe&#39;: array([-136.5099332 , -153.36502206]),
 &#39;force&#39;: array([[[ 5.04922715e+00,  3.88846289e+00, -5.76527446e-01],
         [ 1.22667134e+00,  1.19997275e+00,  9.22135692e-01],
         [-1.58717859e+00,  8.76783145e+00, -5.60433405e-01],
         [-6.93273543e+00, -6.54945164e+00,  6.64847643e-01],
         [ 1.34822311e+01, -2.59522258e+00, -2.76919111e-01],
         [-6.82549443e+00,  5.64956968e+00,  9.93711543e-01],
         [ 6.19440585e-01, -1.22302331e+00, -1.03586510e+00],
         [ 3.34822075e+00, -6.80631220e+00,  8.68747528e-01],
         [-1.61850233e+00, -5.24070459e+00, -7.82759048e-03],
         [-2.46282058e+00, -1.06266820e+00,  6.10481562e-01],
         [-2.44539644e+00,  1.68998793e+00, -9.56095695e-01],
         [ 5.94787139e-01,  1.42905790e+00,  4.00582009e-01],
         [ 1.20248926e+00, -9.02423079e-01,  3.64103293e-01],
         [ 3.40491891e+00, -6.16421312e+00, -1.28161026e+00],
         [-1.15112616e+01,  8.72547186e+00,  6.77046087e-01],
         [ 4.13543575e+00, -5.34438615e+00, -6.98549020e-01],
         [-4.89300184e+00, -4.96259265e+00, -1.18911142e+00],
         [ 1.59686071e+00,  6.98478408e+00,  1.33026015e+00],
         [-3.63015564e+00, -2.51527049e+00, -2.20178302e-01],
         [ 8.80915543e+00, -2.24479045e+00, -1.12263239e+00],
         [-2.53229707e+00, -2.42439606e+00,  1.15434640e+00],
         [ 4.07822936e-01,  4.14177701e+00, -1.37279283e+00],
         [-4.23734545e+00,  5.86204684e+00,  1.53730706e+00],
         [ 4.79892837e+00, -3.03507866e-01, -2.25026401e-01]],

        [[-4.76447441e-01,  1.63510274e-01,  1.18536005e-01],
         [ 1.05951650e+00,  1.13975326e+00,  3.03026808e-01],
         [-1.10388392e+00,  1.82692624e+00,  2.43670851e-01],
         [ 3.45347205e-01,  2.14679327e-01,  2.12337239e-01],
         [ 2.10264116e-01,  1.99330632e-01,  4.40028769e-02],
         [ 5.63858798e-01,  1.52263180e+00,  2.68906252e-01],
         [-6.79256974e-01,  1.99835513e-01, -9.92013534e-02],
         [ 3.28548163e+00, -3.88054169e+00,  4.76883738e-01],
         [-6.64844479e-01,  9.54338853e-03, -2.16759837e-01],
         [-2.12108350e+00,  9.39029562e-02,  6.08379775e-02],
         [ 2.11020282e+00, -2.54960785e-01, -5.02313110e-01],
         [ 4.21865916e-01, -9.47899304e-02, -2.76249571e-02],
         [-1.71754536e+00, -2.68912929e+00, -2.42146028e-01],
         [-1.21274135e-01, -8.45067523e-02,  2.00398951e-01],
         [-2.91123679e+00,  4.84291794e+00, -2.21613116e-01],
         [ 1.23092030e-01, -1.13521590e+00,  1.13412431e-01],
         [-6.81303939e-01, -1.39141315e+00, -3.03941651e-02],
         [-2.11571560e+00,  1.06007468e-01,  7.87334725e-02],
         [ 2.22899201e+00, -3.20126551e-01,  2.61670329e-02],
         [ 1.11188693e+00, -1.82723774e+00, -3.03112758e-01],
         [-9.83036805e-01, -9.70364359e-01, -2.89505703e-01],
         [ 7.98264454e-01,  2.62026199e+00, -1.68686493e-01],
         [ 1.06598347e+00, -6.42911965e-01,  1.83220157e-01],
         [ 2.50873054e-01,  3.51897321e-01, -2.28776273e-01]]]),
 &#39;stress&#39;: array([[ 3.5707734 ,  0.08198568, -0.13705068,  0.08198567,  2.40799502,
          0.17015844, -0.13705069,  0.17015844,  0.09324797],
        [ 0.44563917,  0.1193755 ,  0.07901992,  0.1193755 ,  0.58555032,
          0.00891055,  0.07901992,  0.00891055,  0.00594129]])}
</pre></div></div>
</div>
<section id="Save-trained-model">
<h3>Save trained model<a class="headerlink" href="#Save-trained-model" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="save(obj,-model_dir,-descriptor=None)">
<h2>save(obj, model_dir, descriptor=None)<a class="headerlink" href="#save(obj,-model_dir,-descriptor=None)" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>obj</strong>: Network object</p></li>
<li><p><strong>model_dir</strong>: directory for saving the trained model</p></li>
<li><p><strong>descriptor</strong>: descriptor parameters used to generate fingerprints, if set, a parameters file is generated for LAMMPS simulation</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">descriptor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;acsf&#39;</span><span class="p">,</span>
              <span class="s1">&#39;cutoff&#39;</span><span class="p">:</span> <span class="mf">6.5001</span><span class="p">,</span>
              <span class="s1">&#39;etaG2&#39;</span><span class="p">:[</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.025</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.075</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
              <span class="s1">&#39;etaG4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">],</span>
              <span class="s1">&#39;zeta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.35</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">50.0</span><span class="p">,</span><span class="mf">100.0</span><span class="p">],</span>
              <span class="s1">&#39;lambda&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]}</span>

<span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;/workspace/data/weigao/machine_learning/graphene.tfdnn&#39;</span>
<span class="n">network</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">save_dir</span><span class="p">,</span><span class="n">descriptor</span><span class="o">=</span><span class="n">descriptor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># print signature</span>
<span class="n">network</span><span class="o">.</span><span class="n">print_signature</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Load-the-saved-model-for-continuous-training-and-prediction">
<h3>Load the saved model for continuous training and prediction<a class="headerlink" href="#Load-the-saved-model-for-continuous-training-and-prediction" title="Permalink to this headline"></a></h3>
<p><strong>load(model_dir)</strong></p>
<ul class="simple">
<li><p><strong>model_dir</strong>: saved model directory</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;/workspace/data/weigao/machine_learning/graphene.tfdnn&#39;</span>
<span class="n">imported_model</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imported_model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">loss_weights</span><span class="o">=</span><span class="n">loss_weights</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imported_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">input_dict</span> <span class="o">=</span> <span class="n">get_input_dict</span><span class="p">(</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">imported_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to AtomDNN’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="atom_descriptor.html" class="btn btn-neutral float-right" title="Atom descritpor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Gao-group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>